# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: macos-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - uses: facebook/install-dotslash@latest

      - name: Checkout
        run: git clone --filter=blob:none https://github.com/work-spaces/workflows
        shell: bash

      - name: Show temp dir
        run: 
          echo $PWD
          ls $PWD
        shell: bash

      - name: Update path
        run: echo "$PWD/workflows/bin" >> $GITHUB_PATH
        shell: bash
      # Runs a single command using the runners shell
      - name: spaces check version
        run: spaces --version
        shell: bash

      - name: spaces create workspace
        run: spaces create --name=spaces-deploy --config=workflows/spaces_deploy.toml
        shell: bash

      - name: show status
        run: ls -alt ./ && ls -alt ./spaces-deploy
        shell: bash

      - name: spaces build
        run: cd spaces-deploy && spaces run-action --name=build
        shell: bash

      - name: spaces deploy
        run: cd spaces-deploy && spaces create-binary-archive --name=spaces --version=v0.2.0 --output=deploy --input=spaces/target/release/spaces
        shell: bash


      

